---
interface Props {
  date: Date | string;
  format?: 'short' | 'long' | 'relative';
}

const { date, format = 'short' } = Astro.props;
const d = new Date(date);

let formatted: string;

switch (format) {
  case 'long':
    formatted = d.toLocaleDateString('en-IE', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    });
    break;
  case 'relative':
    const now = new Date();
    const diff = now.getTime() - d.getTime();
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    if (days === 0) formatted = 'Today';
    else if (days === 1) formatted = 'Yesterday';
    else if (days < 7) formatted = `${days} days ago`;
    else if (days < 30) formatted = `${Math.floor(days / 7)} weeks ago`;
    else if (days < 365) formatted = `${Math.floor(days / 30)} months ago`;
    else formatted = `${Math.floor(days / 365)} years ago`;
    break;
  default:
    formatted = d.toLocaleDateString('en-IE', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    });
}
---

<time datetime={d.toISOString()}>{formatted}</time>