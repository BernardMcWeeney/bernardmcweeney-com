---
/**
 * Local Time Widget
 * Features an orbiting satellite animation around Earth
 * Shows current time, timezone, and day progress
 */
---

<section class="widget" data-local-time>
  <div class="widget-header">
    <span class="widget-icon">ðŸ›°</span>
    <span>Local Time</span>
    <span class="ml-auto text-xs opacity-60" id="time-period">--</span>
  </div>

  <div class="widget-body">
    <div class="flex items-center gap-6">
      <!-- Time Info -->
      <div class="flex-1 min-w-0">
        <div class="flex items-baseline gap-1">
          <p id="clock" class="font-mono text-3xl font-bold text-[var(--color-text-primary)] tabular-nums tracking-tight">
            --:--
          </p>
          <span id="seconds" class="font-mono text-lg text-[var(--color-brand)] tabular-nums">:--</span>
        </div>
        <p id="timezone" class="text-xs text-[var(--color-text-muted)] mt-1 truncate">
          â€”
        </p>
        
        <!-- Day Progress Bar -->
        <div class="mt-3">
          <div class="flex justify-between text-xs text-[var(--color-text-dimmed)] mb-1">
            <span>00:00</span>
            <span id="day-percent" class="text-[var(--color-brand)] font-medium">0%</span>
            <span>24:00</span>
          </div>
          <div class="day-bar">
            <div id="day-fill" class="day-fill"></div>
            <div id="day-marker" class="day-marker"></div>
          </div>
        </div>
      </div>

      <!-- Orbital Animation -->
      <div class="orbit-container" aria-hidden="true">
        <!-- Stars background -->
        <div class="stars"></div>
        
        <!-- Earth -->
        <div class="earth">
          <div class="earth-glow"></div>
          <div class="earth-surface"></div>
          <div class="earth-clouds"></div>
        </div>
        
        <!-- Orbit path -->
        <svg class="orbit-path" viewBox="0 0 100 100">
          <ellipse cx="50" cy="50" rx="42" ry="18" 
            fill="none" 
            stroke="var(--color-border)" 
            stroke-width="0.5"
            stroke-dasharray="2 2"
            opacity="0.5"
          />
        </svg>
        
        <!-- Satellite -->
        <div id="satellite" class="satellite">
          <div class="sat-body"></div>
          <div class="sat-panel sat-panel-l"></div>
          <div class="sat-panel sat-panel-r"></div>
          <div class="sat-signal"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Day Progress Bar */
  .day-bar {
    position: relative;
    height: 4px;
    background: var(--color-bg-elevated);
    border-radius: 2px;
    overflow: visible;
  }

  .day-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--color-brand), var(--color-brand-hover));
    border-radius: 2px;
    transition: width 1s linear;
  }

  .day-marker {
    position: absolute;
    top: 50%;
    left: 0%;
    width: 10px;
    height: 10px;
    background: var(--color-brand);
    border: 2px solid var(--color-bg-surface);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: left 1s linear;
    box-shadow: 0 0 8px var(--color-brand);
  }

  /* Orbital Container */
  .orbit-container {
    position: relative;
    width: 100px;
    height: 100px;
    flex-shrink: 0;
  }

  /* Stars */
  .stars {
    position: absolute;
    inset: 0;
    background-image: 
      radial-gradient(1px 1px at 20% 30%, white, transparent),
      radial-gradient(1px 1px at 40% 70%, white, transparent),
      radial-gradient(1px 1px at 50% 20%, white, transparent),
      radial-gradient(1px 1px at 60% 50%, white, transparent),
      radial-gradient(1px 1px at 70% 80%, white, transparent),
      radial-gradient(1px 1px at 80% 10%, white, transparent),
      radial-gradient(1px 1px at 90% 60%, white, transparent),
      radial-gradient(1px 1px at 10% 90%, white, transparent);
    opacity: 0.4;
    animation: twinkle 3s ease-in-out infinite;
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.6; }
  }

  /* Earth */
  .earth {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 36px;
    height: 36px;
    border-radius: 50%;
  }

  .earth-glow {
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%);
  }

  .earth-surface {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 30%, #1e5631 50%, #2d7b46 70%, #1e3a5f 100%);
    box-shadow: inset -8px -4px 12px rgba(0,0,0,0.5), inset 4px 2px 8px rgba(255,255,255,0.1);
    animation: earth-rotate 60s linear infinite;
  }

  @keyframes earth-rotate {
    to { transform: rotate(360deg); }
  }

  .earth-clouds {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: 
      radial-gradient(ellipse 20% 10% at 30% 40%, rgba(255,255,255,0.4), transparent),
      radial-gradient(ellipse 25% 8% at 60% 30%, rgba(255,255,255,0.3), transparent),
      radial-gradient(ellipse 15% 12% at 70% 60%, rgba(255,255,255,0.35), transparent);
    animation: clouds-drift 45s linear infinite;
  }

  @keyframes clouds-drift {
    to { transform: rotate(360deg); }
  }

  /* Orbit Path */
  .orbit-path {
    position: absolute;
    inset: 0;
    transform: rotateX(70deg);
  }

  /* Satellite */
  .satellite {
    position: absolute;
    width: 16px;
    height: 16px;
    transform-origin: center center;
    animation: orbit 8s linear infinite;
    filter: drop-shadow(0 0 4px var(--color-brand));
  }

  @keyframes orbit {
    0% {
      left: 50%;
      top: 12%;
      transform: translate(-50%, -50%) scale(0.7);
      z-index: 1;
    }
    25% {
      left: 92%;
      top: 50%;
      transform: translate(-50%, -50%) scale(1);
      z-index: 2;
    }
    50% {
      left: 50%;
      top: 88%;
      transform: translate(-50%, -50%) scale(1.2);
      z-index: 3;
    }
    75% {
      left: 8%;
      top: 50%;
      transform: translate(-50%, -50%) scale(1);
      z-index: 2;
    }
    100% {
      left: 50%;
      top: 12%;
      transform: translate(-50%, -50%) scale(0.7);
      z-index: 1;
    }
  }

  .sat-body {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 6px;
    height: 6px;
    background: linear-gradient(135deg, #ddd, #888);
    border-radius: 1px;
  }

  .sat-panel {
    position: absolute;
    top: 50%;
    width: 8px;
    height: 4px;
    background: linear-gradient(180deg, #f97316 0%, #ea580c 50%, #c2410c 100%);
    transform: translateY(-50%);
    border-radius: 1px;
    box-shadow: 0 0 4px rgba(249, 115, 22, 0.5);
  }

  .sat-panel-l { right: 100%; margin-right: -3px; }
  .sat-panel-r { left: 100%; margin-left: -3px; }

  .sat-signal {
    position: absolute;
    left: 50%;
    bottom: 100%;
    width: 2px;
    height: 3px;
    background: var(--color-brand);
    transform: translateX(-50%);
    animation: signal-pulse 1s ease-in-out infinite;
  }

  @keyframes signal-pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 4px var(--color-brand); }
    50% { opacity: 0.3; box-shadow: none; }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .satellite { animation: none; left: 92%; top: 50%; transform: translate(-50%, -50%); }
    .earth-surface, .earth-clouds { animation: none; }
    .stars { animation: none; }
    .sat-signal { animation: none; }
  }
</style>

<script>
  const container = document.querySelector('[data-local-time]');
  if (container) {
    const clockEl = container.querySelector('#clock') as HTMLElement;
    const secondsEl = container.querySelector('#seconds') as HTMLElement;
    const timezoneEl = container.querySelector('#timezone') as HTMLElement;
    const periodEl = container.querySelector('#time-period') as HTMLElement;
    const dayFillEl = container.querySelector('#day-fill') as HTMLElement;
    const dayMarkerEl = container.querySelector('#day-marker') as HTMLElement;
    const dayPercentEl = container.querySelector('#day-percent') as HTMLElement;

    function getPeriod(hours: number): string {
      if (hours >= 5 && hours < 12) return 'ðŸŒ… Morning';
      if (hours >= 12 && hours < 17) return 'â˜€ï¸ Afternoon';
      if (hours >= 17 && hours < 21) return 'ðŸŒ† Evening';
      return 'ðŸŒ™ Night';
    }

    function tick() {
      const now = new Date();
      
      // Update clock (split hours:minutes and seconds)
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');
      
      clockEl.textContent = `${hours}:${minutes}`;
      secondsEl.textContent = `:${seconds}`;

      // Update period
      periodEl.textContent = getPeriod(now.getHours());

      // Update timezone info
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone.replace('_', ' ');
      const dateStr = now.toLocaleDateString('en-IE', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
      });
      timezoneEl.textContent = `${tz} Â· ${dateStr}`;

      // Calculate day progress (0-100)
      const totalSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
      const progress = (totalSeconds / 86400) * 100;

      // Update progress bar
      dayFillEl.style.width = `${progress}%`;
      dayMarkerEl.style.left = `${progress}%`;
      dayPercentEl.textContent = `${Math.round(progress)}%`;
    }

    tick();
    setInterval(tick, 1000);
  }
</script>