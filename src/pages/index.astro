---
import Layout from "../layouts/Layout.astro";
import WindowHero from "../components/WindowHero.astro";
import IrishMap from "../components/IrishMap.astro";
import Weather from "../components/widgets/Weather.astro";
import LocalTime from "../components/widgets/LocalTime.astro";
import NowPlaying from "../components/widgets/NowPlaying.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).sort((a,b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0,3);
const notes = (await getCollection("notes")).sort((a,b)=> b.data.date.valueOf()-a.data.date.valueOf()).slice(0,6);
const docs  = (await getCollection("docs")).slice(0,3);
const projects = (await getCollection("projects"))
  .sort((a,b)=> (a.data.order ?? 999) - (b.data.order ?? 999))
  .slice(0,6);
---

<Layout title="Home" description="Bernard’s personal hub — blog, projects, notes, and docs.">
  <section class="container my-8">
    <!-- Split hero: window (left) + map (right) -->
    <div class="grid gap-4 md:grid-cols-2">
      <WindowHero title="Bernard McWeeney" subtitle="A modern-retro home for my writing, projects, and build logs." />
      <IrishMap imageSrc="/images/ireland.svg" />
    </div>

    <!-- Widgets with accent headers + corners -->
    <div class="mt-6 grid gap-3 md:grid-cols-3">
      <Weather />
      <NowPlaying />
      <LocalTime />
    </div>

    <!-- Personal brand stripe (full orange, but relevant copy) -->
    <div class="mt-8 panel overflow-hidden border-[color:var(--brand)]">
      <div class="bg-[color:var(--brand)] text-white p-5">
        <p class="font-mono">I build things, write about the process, and leave the rough edges in.</p>
      </div>
    </div>

    <!-- Snippet grids -->
    <div class="mt-8 grid-cards">
      <!-- Projects Preview -->
      <section class="card card--6 relative corners">
	  	<span class="sq tl"></span><span class="sq tr"></span><span class="sq bl"></span><span class="sq br"></span>
        <div class="panel-header">
          <span>Projects</span>
          <span class="ml-auto"><a href="/projects/" class="btn">See all →</a></span>
        </div>
        <div class="pt-4 grid gap-3 sm:grid-cols-2">
          {projects.map(p => (
            <a href={`/projects/${p.slug}/`} class="panel p-3 hover:border-[color:var(--brand)] transition-colors">
              <div class="flex items-center justify-between">
                <h3 class="text-base">{p.data.title}</h3>
                {p.data.status && <span class="badge">{p.data.status}</span>}
              </div>
              <p class="text-sm text-[color:var(--muted)] mt-1">{p.data.summary}</p>
            </a>
          ))}
        </div>
      </section>

      <!-- Recent Blog -->
      <section class="card card--6 relative corners">
	  	<span class="sq tl"></span><span class="sq tr"></span><span class="sq bl"></span><span class="sq br"></span>
        <div class="panel-header">
          <span>Recent Posts</span>
          <span class="ml-auto"><a class="btn" href="/blog/">All posts →</a></span>
        </div>
        <ul class="pt-3 space-y-3">
          {posts.map(post => (
            <li class="panel p-3 hover:border-[color:var(--brand)]">
              <a href={`/blog/${post.slug}/`} class="no-underline">
                <h3 class="text-[17px]">{post.data.title}</h3>
                <p class="text-sm text-[color:var(--muted)]">{post.data.description}</p>
              </a>
            </li>
          ))}
        </ul>
      </section>

      <!-- Notes -->
      <section class="card card--4 relative corners">
	  	<span class="sq tl"></span><span class="sq tr"></span><span class="sq bl"></span><span class="sq br"></span>
        <div class="panel-header"><span>Notes</span><span class="ml-auto"><a class="btn" href="/notes/">All notes →</a></span></div>
        <div class="pt-3 space-y-2">
          {notes.map(n => (
            <a href={`/notes/${n.slug}/`} class="panel p-2 block hover:border-[color:var(--brand)]">
              <div class="text-sm">{n.data.title}</div>
              <div class="text-xs text-[color:var(--muted)]">{new Date(n.data.date).toLocaleDateString()}</div>
            </a>
          ))}
        </div>
      </section>

      <!-- Docs -->
      <section class="card card--8 relative corners">
	  	<span class="sq tl"></span><span class="sq tr"></span><span class="sq bl"></span><span class="sq br"></span>
        <div class="panel-header"><span>Docs</span><span class="ml-auto"><a class="btn" href="/docs/">Browse docs →</a></span></div>
        <div class="pt-4 grid gap-3 md:grid-cols-3">
          {docs.map(d => (
            <a href={`/docs/${d.slug}/`} class="panel p-3 hover:border-[color:var(--brand)]">
              <h3 class="text-base">{d.data.title}</h3>
              <p class="text-sm text-[color:var(--muted)]">{d.data.description}</p>
            </a>
          ))}
        </div>
      </section>
    </div>
  </section>
</Layout>
