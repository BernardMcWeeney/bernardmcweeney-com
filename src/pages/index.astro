---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const projects = [
  {
    name: "Greenberry",
    status: "active",
    description: "Web development and IT services for Irish businesses",
    tech: ["WordPress", "React", "Azure"],
    link: "https://greenberry.ie",
  },
  {
    name: "Parish Core",
    status: "development",
    description: "WordPress plugin for Catholic parish management",
    tech: ["WordPress", "PHP", "React"],
    link: null,
  },
];
---

<Layout
  title="Home"
  description="Bernard McWeeney - IT Administrator and Web Developer based in Dublin, Ireland. Building web applications and managing IT infrastructure."
>
  <div class="container">
    <!-- Hero -->
    <section class="hero">
      <h1>Hi, I'm Bernard</h1>
      <p>
        IT Administrator and Web Developer based in Dublin, Ireland.
        I build web applications and manage IT infrastructure for businesses.
      </p>
      <div class="hero-links">
        <a href="/projects" class="btn btn-primary">View Projects</a>
        <a href="/about" class="btn">About Me</a>
      </div>
    </section>

    <!-- Recent Posts -->
    <section class="section">
      <div class="section-header">
        <span class="section-title">Blog</span>
        <h2 class="section-heading">Recent Posts</h2>
      </div>
      <div class="grid grid-2">
        {posts.map((post) => (
          <a href={`/blog/${post.slug}`} class="card card-link">
            <article class="post-card">
              <time class="post-date" datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString("en-IE", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
              <h3 class="post-title">{post.data.title}</h3>
              <p class="post-excerpt">{post.data.description}</p>
              {post.data.tags && (
                <div class="post-tags">
                  {post.data.tags.slice(0, 2).map((tag) => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
            </article>
          </a>
        ))}
      </div>
      <div style="text-align: center; margin-top: 2rem;">
        <a href="/blog" class="btn">View All Posts</a>
      </div>
    </section>

    <!-- Featured Projects -->
    <section class="section">
      <div class="section-header">
        <span class="section-title">Work</span>
        <h2 class="section-heading">Featured Projects</h2>
      </div>
      <div class="grid grid-2">
        {projects.map((project) => (
          <a
            href={project.link || "/projects"}
            class="card card-link"
            target={project.link ? "_blank" : undefined}
            rel={project.link ? "noopener" : undefined}
          >
            <div class="post-card">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <h3 class="post-title">{project.name}</h3>
                <span class={`project-status ${project.status}`}>
                  {project.status === "active" ? "Live" : "In Development"}
                </span>
              </div>
              <p class="post-excerpt">{project.description}</p>
              <div class="project-tech">
                {project.tech.map((t) => (
                  <span class="tech-tag">{t}</span>
                ))}
              </div>
            </div>
          </a>
        ))}
      </div>
      <div style="text-align: center; margin-top: 2rem;">
        <a href="/projects" class="btn">View All Projects</a>
      </div>
    </section>
  </div>
</Layout>
